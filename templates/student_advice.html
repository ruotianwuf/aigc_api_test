<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Advice</title>

     <style>

        body {
            background-image: url("../static/img/background.jpg");
            color: black;
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            background-attachment: fixed;
            font-family: 'SimSun', 'Songti SC', 'serif';
            padding: 20px;
        }


     /* 公共样式 */
.message {
    display: flex;
    flex-direction: column;
    padding: 10px;
    border-radius: 20px;
    margin-bottom: 10px;
    word-wrap: break-word;
    align-items: flex-start;
    width: fit-content;
}


.user-message {
    display: none;
    background-color: white;
    color: black;
    margin-left: auto;
    margin-top: 10px;
    border: 1px solid #ddd;
    align-items: flex-end;
}


.ai-message {
    display: none;
    background-color: #3333cc;
    color: white;
    margin-right: auto;
    border: 1px solid #ddd;
    align-items: flex-start;
}


.avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-bottom: 5px;
}


.name {
    font-weight: bold;
    margin-bottom: 5px;
}


.text {
    max-width: 100%;
    margin: 0;
}

.black-background {
    background-color: black;
    color: white;
    padding: 10px;
    border-radius: 5px;
}

.chat-box{
    margin-top: 15px;
}


    </style>

</head>
<body>

<div class="content-box" id="content">

</div>

<div class="message user-message" id="questionDisplay">
    <img src="../static/img/student.png" alt="User Avatar" class="avatar">
    <div class="name">You</div>
    <div class="text"></div>
</div>
<div class="message ai-message" id="answerDisplay">
    <img src="../static/img/AI%20UI.png" alt="AI Avatar" class="avatar">
    <div class="name">Assistant</div>
    <div class="text"></div>
</div>


<div class="chat-box">
    <input id="questionInput" ty  pe="text" placeholder="输入消息..." style="width: 80%; padding: 8px; border: none; border-radius: 5px;">
    <button onclick="question()" style="padding: 8px 16px; background-color: #555; color: white; border: none; border-radius: 5px;">发送</button>
</div>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    var cookies = document.cookie.split("; ");
            for (var i = 0; i < cookies.length; i++) {
                var cookiePair = cookies[i].split("=");
                if (cookiePair[0] === "student" && cookiePair[1]) {
                    var data = {"username": cookiePair[1]};
                    // alert(JSON.stringify(data));
                    $.ajax({
                      url: "/answer_msg/advice",
                        type: "POST",
                        data: JSON.stringify(data),
                        contentType: "application/json",
                        dataType: "json",
                        success: function(response) {
                            if (response.success) {
                                var replay = response.result


                                replay = replay.replace(/(\d+)\. /g, '$1.');
                                replay = replay.replace(/\((\d+)\) /g, '($1)');
                                replay = replay.replace(/(①|②|③|④|⑤|⑥)/g, '$1 ');
                                replay = replay.replace(/\n/g, '<br>');


                                var outputDiv = document.getElementById("content");
                                outputDiv.innerHTML = "<div class='"+"black-background"+"'>" + replay + "</div>";
                                }
                        },
                        error: function() {
                            alert("错误error");
                        }
                    });
                }
            }


    document.getElementById("questionInput").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            question();
        }
    });

  function question() {
    var questionInput = document.getElementById("questionInput");
    var questionText = questionInput.value.trim();
    if (questionText) {
        var data = { 'question': questionText };
        $.ajax({
            url: "/answer_msg",
            type: "POST",
            data: JSON.stringify(data),
            contentType: "application/json",
            dataType: "json",
            success: function(response) {
                if (response.success) {
                    var formattedAnswer = response.result;
                    formattedAnswer = formattedAnswer.replace(/(\d+)\. /g, '$1. ');
                    formattedAnswer = formattedAnswer.replace(/\((\d+)\) /g, '($1)');
                    formattedAnswer = formattedAnswer.replace(/(①|②|③|④|⑤|⑥) /g, '$1 ');
                    formattedAnswer = formattedAnswer.replace(/\n/g, '<br>');
                    var outputDiv = document.getElementById("content");
                    var questionHTML = "<div class='message user-message' style='display: flex;'>" +
                                       "<img src='../static/img/student.png' alt='User Avatar' class='avatar'>" +
                                       "<div>" +
                                         "<div class='name'>You</div>" +
                                         "<div class='text'>" + "You: " + data.question + "</div>" +
                                       "</div>" +
                                       "</div>";
                    var answerHTML = "<div class='message ai-message' style='display: flex;'>" +
                                     "<img src='../static/img/AI UI.png' alt='AI Avatar' class='avatar'>" +
                                     "<div>" +
                                       "<div class='name'>Assistant</div>" +
                                       "<div class='text'>" + formattedAnswer + "</div>" +
                                     "</div>" +
                                     "</div>";
                    outputDiv.innerHTML += questionHTML + answerHTML;
                    questionInput.value = "";
                } else {
                    alert("未能获取到答案。");
                }
            },
            error: function(xhr, status, error) {
                alert("发生错误，请稍后重试。");
            }
        });
    } else {
        alert("问题不能为空。");
    }
}

</script>
</html>